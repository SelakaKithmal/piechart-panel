{"version":3,"sources":["../src/legend.js"],"names":["angular","module","directive","popoverSrv","$timeout","link","scope","elem","$container","firstRender","ctrl","panel","data","seriesList","dataList","i","legendScrollbar","$on","destroy","events","on","series","color","render","getSeriesIndexForElement","el","parents","toggleSeries","e","currentTarget","index","seriesInfo","scrollPosition","children","scrollTop","sortLegend","stat","legend","sort","sortDesc","getLegendHeaderHtml","statName","name","header","html","_","escape","cssClass","getLegendPercentageHtml","openColorSelector","target","length","find","show","element","position","template","openOn","model","autoClose","toggleAxis","colorSelected","changeSeriesColor","legendType","empty","css","append","width","sideWidth","ieWidth","showValues","values","percentage","tableLayout","toggleClass","legendHeader","valueName","total","stats","seriesShown","seriesElements","seriesData","hideEmpty","allIsNull","decimal","percentageDecimals","hiddenSeries","label","value","legendData","formatValue","pvalue","toFixed","push","topPadding","tbodyElem","addScrollbar","destroyScrollbar","scrollbarOptions","scrollYMarginOffset","suppressScrollX","PerfectScrollbar","update"],"mappings":"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","sourcesContent":["import angular from \"angular\";\nimport kbn from \"app/core/utils/kbn\";\nimport $ from \"jquery\";\nimport \"jquery.flot\";\nimport \"jquery.flot.time\";\nimport _ from \"lodash\";\nimport PerfectScrollbar from \"./lib/perfect-scrollbar.min\";\n\nangular\n  .module(\"grafana.directives\")\n  .directive(\"piechartLegend\", function(popoverSrv, $timeout) {\n    return {\n      link: function(scope, elem) {\n        var $container = $('<div class=\"piechart-legend__container\"></div>');\n        var firstRender = true;\n        var ctrl = scope.ctrl;\n        var panel = ctrl.panel;\n        var data;\n        var seriesList;\n        var dataList;\n        var i;\n        var legendScrollbar;\n\n        scope.$on(\"$destroy\", function() {\n          if (legendScrollbar) {\n            legendScrollbar.destroy();\n          }\n        });\n\n        ctrl.events.on(\"render\", function() {\n          data = ctrl.series;\n          if (data) {\n              for (var i in data) {\n                data[i].color = ctrl.data[i].color;\n              }\n            render();\n          }\n        });\n\n        function getSeriesIndexForElement(el) {\n          return el.parents(\"[data-series-index]\").data(\"series-index\");\n        }\n\n        function toggleSeries(e) {\n          var el = $(e.currentTarget);\n          var index = getSeriesIndexForElement(el);\n          var seriesInfo = dataList[index];\n          var scrollPosition = $($container.children(\"tbody\")).scrollTop();\n          ctrl.toggleSeries(seriesInfo);\n          $($container.children(\"tbody\")).scrollTop(scrollPosition);\n        }\n\n        function sortLegend(e) {\n          var el = $(e.currentTarget);\n          var stat = el.data(\"stat\");\n\n          if (stat !== panel.legend.sort) {\n            panel.legend.sortDesc = null;\n          }\n\n          // if already sort ascending, disable sorting\n          if (panel.legend.sortDesc === false) {\n            panel.legend.sort = null;\n            panel.legend.sortDesc = null;\n            ctrl.render();\n            return;\n          }\n\n          panel.legend.sortDesc = !panel.legend.sortDesc;\n          panel.legend.sort = stat;\n          ctrl.render();\n        }\n\n        function getLegendHeaderHtml(statName) {\n          var name = statName;\n\n          if (panel.legend.header) {\n            name = panel.legend.header;\n          }\n\n          var html = '<th class=\"pointer\" data-stat=\"' + _.escape(statName) + '\">' + name;\n\n          if (panel.legend.sort === statName) {\n            var cssClass = panel.legend.sortDesc\n              ? \"fa fa-caret-down\"\n              : \"fa fa-caret-up\";\n            html += ' <span class=\"' + cssClass + '\"></span>';\n          }\n\n          return html + \"</th>\";\n        }\n\n        function getLegendPercentageHtml(statName) {\n          var name = \"percentage\";\n          var html = '<th class=\"pointer\" data-stat=\"' + statName + '\">' + name;\n\n          if (panel.legend.sort === statName) {\n            var cssClass = panel.legend.sortDesc\n              ? \"fa fa-caret-down\"\n              : \"fa fa-caret-up\";\n            html += ' <span class=\"' + cssClass + '\"></span>';\n          }\n\n          return html + \"</th>\";\n        }\n\n        function openColorSelector(e) {\n          // if we clicked inside poup container ignore click\n          if ($(e.target).parents(\".popover\").length) {\n            return;\n          }\n\n          var el = $(e.currentTarget).find(\".fa-minus\");\n          var index = getSeriesIndexForElement(el);\n          var series = seriesList[index];\n\n          $timeout(function() {\n            popoverSrv.show({\n              element: el[0],\n              position: \"bottom center\",\n              template:\n                '<series-color-picker series=\"series\" onToggleAxis=\"toggleAxis\" onColorChange=\"colorSelected\">' +\n                \"</series-color-picker>\",\n              openOn: \"hover\",\n              model: {\n                autoClose: true,\n                series: series,\n                toggleAxis: function() {},\n                colorSelected: function(color) {\n                  ctrl.changeSeriesColor(series, color);\n                }\n              }\n            });\n          });\n        }\n\n        function render() {\n          if (panel.legendType === \"On graph\" || !panel.legend.show) {\n            $container.empty();\n            elem.find(\".piechart-legend\").css(\"padding-top\", 0);\n            return;\n          } else {\n            elem.find(\".piechart-legend\").css(\"padding-top\", 6);\n          }\n\n\n          if (firstRender) {\n            elem.append($container);\n            $container.on(\"click\", \".piechart-legend-icon\", openColorSelector);\n            $container.on(\"click\", \".piechart-legend-alias\", toggleSeries);\n            $container.on(\"click\", \"th\", sortLegend);\n            firstRender = false;\n          }\n\n          seriesList = data;\n          dataList = ctrl.data;\n\n          $container.empty();\n\n          var width = panel.legendType == \"Right side\" && panel.legend.sideWidth ? panel.legend.sideWidth + \"px\" : \"\";\n          var ieWidth = panel.legendType == \"Right side\" && panel.legend.sideWidth ? panel.legend.sideWidth - 1 + \"px\" : \"\";\n          elem.css(\"min-width\", width);\n          elem.css(\"width\", ieWidth);\n\n          var showValues = panel.legend.values || panel.legend.percentage;\n          var tableLayout =\n            (panel.legendType === \"Under graph\" ||\n              panel.legendType === \"Right side\") &&\n            showValues;\n\n          $container.toggleClass(\"piechart-legend-table\", tableLayout);\n\n          var legendHeader;\n          if (tableLayout) {\n            var header = '<tr><th colspan=\"2\" style=\"text-align:left\"></th>';\n            if (panel.legend.values) {\n              header += getLegendHeaderHtml(ctrl.panel.valueName);\n            }\n            if (panel.legend.percentage) {\n              header += getLegendPercentageHtml(ctrl.panel.valueName);\n            }\n            header += \"</tr>\";\n            legendHeader = $(header);\n          }\n\n          if (panel.legend.percentage) {\n            var total = 0;\n            for (i = 0; i < seriesList.length; i++) {\n              total += seriesList[i].stats[ctrl.panel.valueName];\n            }\n          }\n\n          var seriesShown = 0;\n          var seriesElements = [];\n\n          for (i = 0; i < seriesList.length; i++) {\n            var series = seriesList[i];\n            var seriesData = dataList[i];\n\n            // ignore empty series\n            if (panel.legend.hideEmpty && series.allIsNull) {\n              continue;\n            }\n            // ignore series excluded via override\n            if (!series.legend) {\n              continue;\n            }\n\n            var decimal = 0;\n            if (ctrl.panel.legend.percentageDecimals) {\n              decimal = ctrl.panel.legend.percentageDecimals;\n            }\n\n            var html = '<div class=\"piechart-legend-series';\n            if (ctrl.hiddenSeries[seriesData.label]) {\n              html += \" piechart-legend-series-hidden\";\n            }\n            html += '\" data-series-index=\"' + i + '\">';\n            html += '<span class=\"piechart-legend-icon\" style=\"float:none;\">';\n            html +=\n              '<i class=\"fa fa-minus pointer\" style=\"color:' +\n              seriesData.color +\n              '\"></i>';\n            html += \"</span>\";\n\n            html +=\n              '<a class=\"piechart-legend-alias\" style=\"float:none;\">' +\n              _.escape(seriesData.label) +\n              \"</a>\";\n\n            if (showValues && tableLayout) {\n              var value = seriesData.legendData;\n              if (panel.legend.values) {\n                html +=\n                  '<div class=\"piechart-legend-value\">' +\n                  ctrl.formatValue(value) +\n                  \"</div>\";\n              }\n              if (total) {\n                var pvalue = (value / total * 100).toFixed(decimal) + \"%\";\n                html += '<div class=\"piechart-legend-value\">' + pvalue + \"</div>\";\n              }\n            }\n\n            html += \"</div>\";\n\n            seriesElements.push($(html));\n            seriesShown++;\n          }\n          if (tableLayout) {\n            var topPadding = 6;\n            var tbodyElem = $(\"<tbody></tbody>\");\n            // tbodyElem.css(\"max-height\", maxHeight - topPadding);\n            tbodyElem.append(legendHeader);\n            tbodyElem.append(seriesElements);\n            $container.append(tbodyElem);\n          } else {\n            $container.append(seriesElements);\n          }\n\n          if (panel.legendType === \"Under graph\") {\n            addScrollbar();\n          } else {\n            destroyScrollbar();\n          }\n        }\n        function addScrollbar() {\n          const scrollbarOptions = {\n            // Number of pixels the content height can surpass the container height without enabling the scroll bar.\n            scrollYMarginOffset: 2,\n            suppressScrollX: true\n          };\n\n          if (!legendScrollbar) {\n            legendScrollbar = new PerfectScrollbar(\n              elem[0],\n              scrollbarOptions\n            );\n          } else {\n            legendScrollbar.update();\n          }\n        }\n\n        function destroyScrollbar() {\n          if (legendScrollbar) {\n            legendScrollbar.destroy();\n            legendScrollbar = null;\n          }\n        }\n      }\n    };\n  });\n"],"file":"legend.js"}